# mysql-study


### [18、为什么这些sql业务逻辑相同，性能却查这么多？](https://github.com/geekibli/mysql-study/blob/main/doc/18.%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%BA%9BSQL%E8%AF%AD%E5%8F%A5%E9%80%BB%E8%BE%91%E7%9B%B8%E5%90%8C%E6%80%A7%E8%83%BD%E5%8D%B4%E5%B7%AE%E5%BC%82%E5%B7%A8%E5%A4%A7%EF%BC%9F.pdf)
本文讲解了三种情况下，不会走索引的情况，基本都是因为显示或隐式的使用的函数。  
- 使用month函数导致索引失效
- 类型转换导致（隐式）索引失效 
- 对于字符串类型，字符编码不一致会导致索引失效，保证查询的字段和传入的参数编码格式一致，如果无法保证，就转换一下请求参数的编码格式，设置成要查询的字段的编码格式

### [19.为什么我只查一行的语句也执行这么慢？](https://github.com/geekibli/mysql-study/blob/main/doc/19.%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E5%8F%AA%E6%9F%A5%E4%B8%80%E8%A1%8C%E7%9A%84%E8%AF%AD%E5%8F%A5%E4%B9%9F%E6%89%A7%E8%A1%8C%E8%BF%99%E4%B9%88%E6%85%A2%EF%BC%9F.pdf)

本文主要介绍了一个简单查询，但是很慢的情况，分成两种情况（前提不考虑mysql服务器，io等其他因素）
- 查询时间长不返回 （有可能在等别的线程释放MDL写锁,因为别的MDL写锁和接下来的读操作是阻塞的）
- 等待flush （flush table会锁表 ， 正常情况下flush动作很快，如果查询慢是因为等待flush造成的，那么可能flush也被阻塞了）
- 等待行锁 （如果你是当前读，可能别的事务在update，你就必须wait）
- 扫描行数多 （limit 50000 1 虽然只查询一行，但是如果没有索引，需要扫描50000行）
- 快照读（快照落后版本太多，也就是版本太低，需要根据当前版本，结合redo log会退 ，这属于mvcc的知识，如果中间版本间隔太多的话，可能会比较慢）

### [20.幻读是什么幻读有什么问题？](https://github.com/geekibli/mysql-study/blob/main/doc/20.%E5%B9%BB%E8%AF%BB%E6%98%AF%E4%BB%80%E4%B9%88%E5%B9%BB%E8%AF%BB%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F.pdf)

主要介绍了什么是幻读：在可重复读下，一般的查询事快照查，是不会查到别的事务提交的记录的，但是，当前读是读取的最新版本，因此幻读是在 【当前读】下发生的。 **幻读专只的是“新插入的行”**
幻读有什么问题呢：  
- 造成语义上的不一致，本来要锁一行的，结果新插入几条数据（符合筛选条件）
- 造成数据的不一致，可能导致binlog在做数据同步的时候，主从数据不一致
如何解决幻读：  
间隙锁（只有在可重复读下存在），加锁的时候，不但锁住所有扫描的记录，记录之间的间隙也锁住，这样就不能insert了。**间隙锁+行锁= Next-Key Lock(前开后闭) **

### [21.为什么我只改一行的语句锁这么多？](https://github.com/geekibli/mysql-study/blob/main/doc/21.%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E5%8F%AA%E6%94%B9%E4%B8%80%E8%A1%8C%E7%9A%84%E8%AF%AD%E5%8F%A5%E9%94%81%E8%BF%99%E4%B9%88%E5%A4%9A%EF%BC%9F.pdf)
本文主要介绍了innodb的加锁规则。介绍了具体的规则和优化，还有8个案例辅助来学习。  
其实这一篇文章不是很好理解，简易多读几遍，另外，评论区也有很多值得学习的知识。  



